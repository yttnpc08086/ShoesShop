<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <th:block th:replace="~{lib/inject}"></th:block>
    <link rel="stylesheet" th:href="@{/css/adminStyle.css}">
    <title>Admin</title>

</head>

<body>
<div class="top-container">
    <div class="nav">
        <div class="logo">
            <i class='bx bxl-codepen'></i>
            <a href="/">SHOESSHOP</a>
        </div>

        <div class="nav-links">
            <a href="/">Dashboard</a>
            <a href="/customer">Customer</a>
            <a href="/category">Category</a>
            <a href="/product">Product</a>
        </div>

        <div class="right-section">
            <i class='bx bx-bell'></i>
            <i class='bx bx-search'></i>

            <div class="profile" sec:authorize="isAuthenticated()">
                <div class="info">
                    <img src="assets/profile.png" alt="Profile Picture">
                    <div>
                        <a href="#">Alex Johnson</a>
                        <p>Data Scientist</p>
                    </div>
                </div>
                <i class='bx bx-chevron-down'></i>
                <div class="dropdown-menu">
                    <a href="#">Profile</a>
                    <a href="#">Client</a>
                    <a>
                        <form th:action="@{/logout}" method="post">
                            <button type="submit" class="logout">Logout</button>
                        </form>
                    </a>
                </div>
            </div>
            <!-- Phần cho trạng thái chưa đăng nhập -->
            <div class="login-buttons" sec:authorize="!isAuthenticated()">
                <a href="#" class="btn btn-primary" th:onclick="|window.location.href='@{/login}'|">Đăng Nhập</a>
                <a href="#" class="btn btn-warning" th:onclick="|window.location.href='@{/register}'|">Đăng Ký</a>
            </div>
        </div>
    </div>

    <div class="status"></div>
</div>
<div class=" mt-5">

    <div class="container card shadow-sm">
        <div class="card-header  text-dark">
            <h1 class="h5 mb-0">Create Customer</h1>
        </div>
        <div class="card-body">
            <form id="customerForm" th:action="@{/customer/update}" th:object="${customer}" method="post" novalidate>
                <input type="hidden" id="id" name="id" th:value="${customer.id}">

                <div class="mb-3">
                    <label for="fullname" class="form-label">Full Name:</label>
                    <input type="text" id="fullname" name="fullname" th:value="${customer.fullname}" class="form-control" required
                           pattern="^(?! )[a-zA-Z0-9 ]+(?<! )$|^(?! )[a-zA-Z0-9]*(?! )$">
                    <div class="error-message text-danger" id="fullname-error" style="display:none;">Full Name must not be empty, contain special characters, or consecutive spaces.</div>
                </div>

                <div class="mb-3">
                    <label for="username" class="form-label">Username:</label>
                    <input type="text" id="username" name="username" th:value="${customer.username}" class="form-control" required
                           pattern="^[a-zA-Z0-9]+$">
                    <div class="error-message text-danger" id="username-error" style="display:none;">Username must not contain special characters.</div>
                </div>

                <div class="mb-3">
                    <label for="password" class="form-label">Password:</label>
                    <input type="password" id="password" name="password" th:value="${customer.password}" class="form-control" required
                           pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$">
                    <div class="error-message text-danger" id="password-error" style="display:none;">Password must be at least 8 characters, with at least 1 uppercase, 1 lowercase letter, and 1 digit.</div>
                </div>

                <div class="mb-3">
                    <label for="email" class="form-label">Email:</label>
                    <input type="email" id="email" name="email" th:value="${customer.email}" class="form-control" required
                           pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$">
                    <div class="error-message text-danger" id="email-error" style="display:none;">Please enter a valid email address.</div>
                </div>

                <div class="mb-3">
                    <label for="phone" class="form-label">Phone:</label>
                    <input type="text" id="phone" name="phone" th:value="${customer.phone}" class="form-control" required
                           pattern="(03|05|07|08|09)[0-9]{8}">
                    <div class="error-message text-danger" id="phone-error" style="display:none;">Phone must be 10 digits and start with 03, 05, 07, 08, or 09.</div>
                </div>

                <div class="mb-3">
                    <label for="address" class="form-label">Address:</label>
                    <input type="text" id="address" name="address" th:value="${customer.address}" class="form-control" required
                           pattern="^(?! )[a-zA-Z0-9 ]+(?<! )$|^(?! )[a-zA-Z0-9]*(?! )$">
                    <div class="error-message text-danger" id="address-error" style="display:none;">Address must not be empty, contain special characters, or consecutive spaces.</div>
                </div>

                <div class="mb-3">
                    <label for="role" class="form-label">Role:</label>
                    <select id="role" name="role" class="form-select" th:value="${customer.role}" required>
                        <option value="" disabled>Select Role</option>
                        <option value="ADMIN" th:selected="${customer.role == 'ADMIN'}">Admin</option>
                        <option value="USER" th:selected="${customer.role == 'USER'}">User</option>
                    </select>
                    <div class="error-message text-danger" id="role-error" style="display:none;">Please select a role.</div>
                </div>

                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>

            <script>
                // Để chỉ hiện lỗi khi người dùng tương tác
                document.querySelectorAll('.form-control, .form-select').forEach(input => {
                    input.addEventListener('input', function() {
                        const feedback = this.nextElementSibling; // Lấy phần tử thông báo lỗi
                        if (feedback) {
                            if (this.checkValidity()) {
                                feedback.style.display = 'none'; // Ẩn thông báo lỗi nếu trường hợp lệ
                            } else {
                                feedback.style.display = 'block'; // Hiện thông báo lỗi nếu trường không hợp lệ
                            }
                        }
                    });

                    input.addEventListener('focus', function() {
                        const feedback = this.nextElementSibling; // Lấy phần tử thông báo lỗi
                        if (feedback) {
                            feedback.style.display = 'none'; // Ẩn thông báo lỗi khi người dùng tương tác
                        }
                    });
                });

                // Xử lý sự kiện gửi form
                document.getElementById('customerForm').addEventListener('submit', function(event) {
                    let valid = true;

                    // Kiểm tra tất cả các trường có class 'form-control' và 'form-select'
                    this.querySelectorAll('.form-control, .form-select').forEach(input => {
                        if (!input.checkValidity()) {
                            valid = false;
                            input.classList.add('is-invalid');
                            const feedback = input.nextElementSibling;
                            if (feedback) {
                                feedback.style.display = 'block'; // Hiện thông báo lỗi
                            }
                        } else {
                            input.classList.remove('is-invalid'); // Xóa lớp không hợp lệ
                        }
                    });

                    // Ngăn chặn gửi form nếu không hợp lệ
                    if (!valid) {
                        event.preventDefault();
                    }
                });
            </script>



        </div>
    </div>
</div>


<th:block th:replace="~{lib/script}"></th:block>

</body>
</html>
